---
title: "Crash Report"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Project 1

#Introduction: This project studies common patterns regardiing crashes in Montgomery County regarding weather conditions, car sizes, and damage to the humans and vehicles involved.


```{r}
dat = read.csv("https://raw.githubusercontent.com/IsraelAndrade22/MontgomeryCountyCrashData/master/Crash_Reporting_-_Drivers_Data.csv")
#data cleaning
dat$Driver.Substance.Abuse[is.na(dat$Driver.Substance.Abuse)] = "UNKNOWN"
dat$Driver.Substance.Abuse[dat$Driver.Substance.Abuse == "N/A"] = "UNKNOWN"
dat$Vehicle.Movement[dat$Vehicle.Movement == "N/A"] = "UNKNOWN"
dat$Vehicle.Body.Type[dat$Vehicle.Body.Type == "N/A"] = "UNKNOWN"
dat$Vehicle.Damage.Extent[dat$Vehicle.Damage.Extent == "N/A"] = "UNKNOWN"
dat$Light[dat$Light == "N/A"] = "UNKNOWN"
dat$Surface.Condition[dat$Surface.Condition == "N/A"] = "UNKNOWN"
dat$Weather[dat$Weather == "N/A"] = "UNKNOWN"
dat$Collision.Type[dat$Collision.Type == "N/A"] = "UNKNOWN"

dat$Driver.Substance.Abuse = factor(dat$Driver.Substance.Abuse)
dat$Vehicle.Movement = factor(dat$Vehicle.Movement)
dat$Vehicle.Body.Type = factor(dat$Vehicle.Body.Type)
dat$Vehicle.Damage.Extent = factor(dat$Vehicle.Damage.Extent)
dat$Light = factor(dat$Light)
dat$Surface.Condition = factor(dat$Surface.Condition)
dat$Weather = factor(dat$Weather)
dat$Collision.Type = factor(dat$Collision.Type)
```
#Data Cleaning:

For this data, the causes of the empty rows was not always clear, however they could not be easily be removed due to their frequency. Instead, they were integrated into pre-existing categories based on what was the most similar. In most cases, this meant replacing NA value with "UNKNOWN".The columns in which this could not be done due to either the collumn not having an "UNKNOWN" category, or the "UNKNOWN" category having additional meaning were not used. 

###Plot the frequency of the weather conditions of vechicle crashes
```{r}
# Intro: In this graph we wanted to view the number of crashes based on the weather condition when the crash happend

# Results: The weather conditions inlvolved with the most crashed ranged from Clear, Raining, Cloudy, followed by other. The result was a bit surpising as we did not expect as meany crashed when the weather condition was clear. 
par(mar=c(2,10,2,2))

datWeather = dat$Weather
for(x in 1:length(datWeather)) {
  if(datWeather[x] != "CLEAR" & datWeather[x] != "RAINING" & datWeather[x] != "CLOUDY") {
    datWeather[x] = "OTHER"
  }
}

newDat = datWeather[datWeather == "RAINING" | datWeather == "CLOUDY" | datWeather == "CLEAR"  | datWeather == "OTHER"]
barplot(head(sort(table(datWeather), decreasing = T), 4), horiz=T, las=1, col="firebrick")

barplot(table(dat$Weather), horiz=T, las=1, col="firebrick")
```

###Plot the Injurey severity based on alcohol abuse
```{r}

# Intro: For the graph below we wanted to obtain information about substance such as alcholo and illegal drugs being present when involved in a crash. We used two attributes (Driver.Substance.Abuse and Injury.Severity) to plot the different levels of crash injury based on substance being present. 

# Results: More invididuals with a substance being present were involved in more vehicle crashed than those without any thing in their their systems. In addition, fatal injuries were present when the driver was abusing a substance 

par(mfrow=c(2,1), mar = c(4,14,2,1), cex = .75)
substancePresent = dat[dat$Driver.Substance.Abuse == "ALCOHOL PRESENT" | dat$Driver.Substance.Abuse == "ILLEGAL DRUG PRESENT", ]
substanceNotPresent = dat[dat$Driver.Substance.Abuse != "ALCOHOL PRESENT" & dat$Driver.Substance.Abuse == "ILLEGAL DRUG PRESENT", ]

presentAbuse = table(substancePresent$Injury.Severity)
noPresentAbuse = table(substanceNotPresent$Injury.Severity)

barplot(c(presentAbuse["FATAL INJURY"], presentAbuse["POSSIBLE INJURY"], presentAbuse["SUSPECTED SERIOUS INJURY"]), col="firebrick", main = "Injury Severity on Substance Present",
    xlab = "Amounts", horiz = T, las=2)
barplot(c(noPresentAbuse["FATAL INJURY"], noPresentAbuse["POSSIBLE INJURY"], noPresentAbuse["SUSPECTED SERIOUS INJURY"]), col="firebrick", main = "Injury Severity on Substance Not Present",
    xlab = "Amounts", horiz = T, las=2)
```


##Intro: explain what you will do in a sentence or two
``` {r}
par(mfrow=c(1,3))
par(mar=c(10,4,2,2))
#Intro:
#Result:
pickupTruck = table(dat$Vehicle.Damage.Extent[dat$Vehicle.Body.Type == "PICKUP TRUCK"])
sportsVehicles = table(dat$Vehicle.Damage.Extent[dat$Vehicle.Body.Type == "(SPORT) UTILITY VEHICLE"])
passengerCar = table(dat$Vehicle.Damage.Extent[dat$Vehicle.Body.Type == "PASSENGER CAR"])

barplot(c(sportsVehicles["DESTROYED"], sportsVehicles["DISABLING"], sportsVehicles["FUNCTIONAL"]), col="firebrick", main = "Vehicle damage on sports cars", las=2)
barplot(c(pickupTruck["DESTROYED"], pickupTruck["DISABLING"], pickupTruck["FUNCTIONAL"]), col="firebrick", main = "Vehicle damage on pick up trucks", las=2)
barplot(c(passengerCar["DESTROYED"], passengerCar["DISABLING"], passengerCar["FUNCTIONAL"]), col="firebrick", main = "Vehicle damage on passenger cars", las=2)

```

###Plot of the vehicle damage extend average based on the vechicle body type
``` {r}
par(mfrow=c(1,3), mar = c(10,4,2,2))

#Intro: For this section we wanted to obtain the average vehicle damage extent based on the vehicle body type. The attributes that were used for this observation was (Vehicle.Body.Type and Vehicle.Damage.Extent)

#Result:The results illustrate that pickup trucks were less prone to be destroyed or disabled compared to SUVs and passanger cars. In addition, passanger cars and SUVs had similar results for the vehicle damage extent

pickupTruck = dat[dat$Vehicle.Body.Type == "PICKUP TRUCK",]
pickupTruckDestroyedAvg = mean(pickupTruck$Vehicle.Damage.Extent == "DESTROYED")
pickupTruckDisablingAvg = mean(pickupTruck$Vehicle.Damage.Extent == "DISABLING")
pickupTruckFunctionalAvg = mean(pickupTruck$Vehicle.Damage.Extent == "FUNCTIONAL")

sportsVehicles = dat[dat$Vehicle.Body.Type == "(SPORT) UTILITY VEHICLE",]
sportsVehiclesDestroyedAvg = mean(sportsVehicles$Vehicle.Damage.Extent == "DESTROYED")
sportsVehiclesDisablingAvg = mean(sportsVehicles$Vehicle.Damage.Extent == "DISABLING")
sportsVehiclesFunctionalAvg = mean(sportsVehicles$Vehicle.Damage.Extent == "FUNCTIONAL")


passengerCar = dat[dat$Vehicle.Body.Type == "PASSENGER CAR",]
passengerCarDestroyedAvg = mean(passengerCar$Vehicle.Damage.Extent == "DESTROYED")
passengerCarDisablingAvg = mean(passengerCar$Vehicle.Damage.Extent == "DISABLING")
passengerCarFunctionalAvg = mean(passengerCar$Vehicle.Damage.Extent == "FUNCTIONAL")

avgDestroyed = c(pickupTruckDestroyedAvg, sportsVehiclesDestroyedAvg, passengerCarDestroyedAvg)
names(avgDestroyed) = c("pickup truck", "sport vehicle", "passenger vehicle")

avgDisabling = c(pickupTruckDisablingAvg, sportsVehiclesDisablingAvg, passengerCarDisablingAvg)
names(avgDisabling) = c("pickup truck", "sport vehicle", "passenger vehicle")

avgFunctional = c(pickupTruckFunctionalAvg, sportsVehiclesFunctionalAvg, passengerCarFunctionalAvg)
names(avgFunctional) = c("pickup truck", "sport vehicle", "passenger vehicle")


barplot(avgDestroyed, col="firebrick", main = "Vehicle Destroyed Average",
    las=2)
barplot(avgDisabling, col="yellow", main = "Vehicle Disabled Average",
    las=2)
barplot(avgFunctional, col="green", main = "Vehicle Functional Average",
    las=2)
 
```



###Most common vehicle collisions
```{r}
#c(bottom, left, top, right)
par(mar=c(14,5,1,1), cex = .75)
newDat = dat[dat$Collision.Type != "",]
newDat = na.omit(newDat)
topCollisons = head(sort(table(newDat$Collision.Type), decreasing = T), 4)
barplot(topCollisons, col = "firebrick",las=2)

```

###Plot the most common crashed on certain roads
``` {r}
#are some kinds of crashes more common on certain kinds of roads
#Road.Name, Collision.Type, 
#Top three roads with number of crashes GEORGIA AVE NEW HAMPSHIRE AVE      FREDERICK RD

georgiaAve = dat[dat$Road.Name == "GEORGIA AVE",]
newHampshireAve = dat[dat$Road.Name == "NEW HAMPSHIRE AVE",]
frederickRoad = dat[dat$Road.Name == "FREDERICK RD",]
#head(sort(table(georgiaAve$Collision.Type), decreasing = T), 3)
#head(sort(table(newHampshireAve$Collision.Type), decreasing = T), 3)
stash = data.frame(table(georgiaAve$Collision.Type),table(newHampshireAve$Collision.Type),table(frederickRoad$Collision.Type))[c(1,2,4,6)]
names(stash) = as.character(stash[1])
colnames(stash) = c("names","Georgia", "NewHampsire", "Fredrick")
par(mar = c(15,5,2,2), las=2, cex = 0.7)
plot(stash$NewHampsire ~ stash$names, xlab = "", ylab = "Number of Crashes", type = "p")
lines(stash$Georgia, type = "p", col = "RED")
lines(stash$Fredrick, type = "p", col = "blue")
legend( "topleft", legend = c("New Hampshire", "Georgia", "Fredrick" ), col = c("black", "red", "blue"), pch = 1)
```

##Map of the different collision within Montgomery County
``` {r}
#Intro: For this graph we wanted to illustrate a map with across the Montgomery County with dots on the location of each cross
#Result: The graph displays roads drawed by points across the graph illustrating the common areas of crashes
plot(dat$Latitude, dat$Longitude, xlim = c(38.8, 39.4), ylim = c(-77, -77.4), pch = ".", 
     xlab = "Latitude", ylab = "Longitude")
```

##Map of off road collisions within Montgomery County
``` {r}
#Intro: For this graph we wanted to illustrate the collisons that have occured off the road to help us determine if these type of collision are common around this county
#Result: The graph displays many of the off road collisions occuring around the same areas. Most of these collisions also occured near local roads
plot(dat$Latitude, dat$Longitude, xlim = c(38.8, 39.4), ylim = c(-77, -77.4), pch = ".", xlab = "Latitude", ylab = "Longitude")
data=dat[dat$Off.Road.Description !="",]
points(data$Latitude, data$Longitude, col="red", pch=".",
       xlab = "Latitude", ylab = "Longitude")

```
##Frequency of crashes sorted by day of the week
``` {r}
dat$dtime = strptime(as.character(dat$Crash.Date.Time),
                     "%m/%d/%Y %I:%M:%S %p",
                     tz="America/New_York")

day_of_the_week = table(dat$dtime$wday)
names(day_of_the_week) = c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday")
barplot(sort(day_of_the_week), col = "firebrick",las=2)
```

##Frequency of time of day when crashes occur
``` {r}
datTimeofDay = table(dat$dtime$hour)
names(datTimeofDay) = c("12 AM", "1 AM", "2 AM", "3 AM", "4 AM", "5 AM", "6 AM", "7 AM", "8 AM", "9 AM", "10 AM",
                        "11 AM", "12 PM", "1 PM", "2 PM", "3 PM", "4 PM", "5 PM", "6 PM", "7 PM", "8 PM", "9 PM",
                        "10 PM", "11 PM")

barplot(datTimeofDay, las=2)
```
#Conclusion: 

The statistic that caught my eye the most was the weather - most crashes happened when skys are clear. It would be interesting to take this information further and compare it to the number of cars on the road and the weather in Montgomery County, however this is beyond the scope. The frequency of rear ending on NewHampshire Ave was also surprising, especially when compared to other crashes on the road. Rearending someone does not require fancy manuvers, changing lanes, or merging onto the freeway, which brings a question of why it happens so often. And the clear skys also contradict conventional wisdom. This brings up some questions which the data can't answer, largely because it would need to be averaged against other data; for example how many cars were on the road. It can, however, answer the question of if it is okay to drink and drive. With around 9 times as many crashes from drunk drivers than sober ones, that answer remains a firm no.
``` {r}
```